<!DOCTYPE html>  <html> <head>   <title>examplecampaign.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               examplecampaign.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h2>Example Campaign</h2>

<p>This is a node module that exports one single object containing the campaign configuration.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>The <em>testFunction</em> is a function that accepts one single argument. It defines a single test iteration that is executed by each firtual user.
    function testFunction (doneCallback) { ... }</p>

<p>The single iteration is considered finished when function calls <em>doneCallback</em>
Different iterations share the same scope. The scope contains 3 variables:</p>

<ul>
<li>context (initialized to null)</li>
<li>window (the window object)</li>
<li>camut (an object containing camut specific options</li>
</ul>

<p>Also note that <em>this</em> is by default scoped to the <em>window</em> object</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h3>Declare the testFunction</h3>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">function</span> <span class="nx">testFunction</span> <span class="p">(</span><span class="nx">doneCallback</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>It is possible to perform initialization tasks by checking scoped variables like context</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">context</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>The test function can report statistics directly to the OpenTSDB server using 'camut.tsdb' function directly. </p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">camut</span><span class="p">.</span><span class="nx">tsdb</span> <span class="p">(</span><span class="s1">&#39;test.dadeb&#39;</span><span class="p">,</span> <span class="nx">context</span><span class="p">.</span><span class="nx">i</span><span class="o">++</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">reqtype</span><span class="o">:</span> <span class="s1">&#39;valore&#39;</span>
  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Functions writing to standard output are supported and their output will be logged on the drone. Note that this also means that logging too much data can slow down operations and use a lot of disk space.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="p">(</span><span class="s1">&#39;ciao&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Once all iteration tasks are completed the function calls <em>doneCallback()</em></p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">setTimeout</span> <span class="p">(</span><span class="nx">doneCallback</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <h3>The exported object</h3>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Each campaign must have a unique user-assigned id. </p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">id</span><span class="o">:</span> <span class="s2">&quot;dev_Example&quot;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>The user can embed any serializable custom structure of attributes and objects.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">customAttribute</span><span class="o">:</span> <span class="s2">&quot;attribute&quot;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p><strong>Deployment</strong> defines the type of service the deployer engine is going to use to deploy drones for this campaign. <em>Dummy</em> is a simple deployer that only deploys one single drone on the same machine where the server is running. It's used only for test purposes before conducting a real campaign on the cloud. </p>

<p>The only real cloud deployer only supported is 'ec2'.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">deployment</span><span class="o">:</span> <span class="s2">&quot;ec2&quot;</span><span class="p">,</span> <span class="cm">/* &quot;dummy&quot; */</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p><strong>AvailabilityZone</strong> defines the availability zone where drone instances will be deployed. It's also possible to specify a list of values, i.e.</p>

<pre><code>AvailabilityZone: ['eu-west-1', 'us-east-2']
</code></pre>

<p>In this case a number of instances specified by 'drone' parameter will be deployed <em>for</em> <em>each</em> AvailabilityZone</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">AvailabilityZone</span><span class="o">:</span> <span class="s1">&#39;eu-west-1&#39;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p><strong>simulateBrowser</strong> activates browser emulation for each virtual user. This means that window object will contain all attributes a normal browser window object would do. It also includes jquery-1.6.0 automatically. Please note that each virtual browser will use up to 2Mb of ram, meaning this option is not suitable for campaigns simulating many virtual users (high value of <em>parallelism</em> parameter)</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">simulateBrowser</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p><strong>monitorProgress</strong> specifies that the progress status for each drone will be reported and visualized in the kue web interface</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">monitorProgress</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p><strong>duration</strong> is the maximum duration of the campaign (seconds). If iterations are not finished in time the campaign will be terminated anyway</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">duration</span><span class="o">:</span> <span class="mi">10</span><span class="p">,</span> <span class="cm">/* 10 seconds */</span>
  </pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p><strong>testIterations</strong> is the number of iterations that each virtual user will have to complete before finish his job.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">testIterations</span><span class="o">:</span> <span class="mi">100</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p><strong>parallelism</strong> represents how many virtual users will be simulated for each drone instance.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">parallelism</span><span class="o">:</span> <span class="mi">10</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p><strong>drones</strong> is the number of drones to be deployed for the campaign <em>for</em> <em>each</em> availability zone</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">drones</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p><strong>rampUpTime</strong> is defined as the time the system will take to reach the total number of virtual users (milliseconds). The total number of virtual users is currently equal to </p>

<pre><code>n_users = parallelism * drones * [number of AvailabilityZones]
</code></pre>

<p>Users will start one by one separated by </p>

<pre><code>rampUpTime / n_users
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">rampUpTime</span><span class="o">:</span> <span class="mi">5000</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p><strong>thinkingTime</strong> is the time that separates each virtual user test iteration (milliseconds)</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">thinkingTime</span><span class="o">:</span> <span class="mi">1000</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p><strong>measureTTFB</strong> tells if Time To First Byte time should be measured</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">measureTTFB</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p><strong>testFunction</strong> attribute must contain the serialized version of the test function aforementioned</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">testFunction</span><span class="o">:</span> <span class="nx">testFunction</span><span class="p">.</span><span class="nx">toString</span> <span class="p">()</span>
<span class="p">};</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 